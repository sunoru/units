# -*- coding:utf-8 -*-
# filename: sciNote/units/bases.py
# by スノル

import traits.api as ta
from .util import NOW_UNITS, newUnit
from .locals import *
#PreName = 'the_unit_'
class BaseUnit():
    ratio=1e0
class Unit(BaseUnit):
    def __init__(self, ratio=1e0, unittype=None):
        self.ratio = ratio
        if unittype is None:
            self.unittype = (0,)*7
        else:
            self.unittype = unittype
LENGTH_RATIOS = {
    u'm':1e0, u'km':1e3, u'cm':1e-1, u'mm':1e-3,
    u'µm':1e-6, u'nm':1e-9, u'pm':1e-12, u'fm':1e-15,
    u'Å',
}
MASS = 2
TIME = 3
CURRENT = 4
TEMPERATURE = 5
AMOUNT = 6
LUMINOUS = 7
UNIT_RATIOS = {LENGTH:LENGTH_RATIOS, 

NOW_UNITS = {}
def newUnit(unit):
    NOW_UNITS[unit.unittype+(ratio,)] = unit

def askUnit(unittype):
    if NOW_UNITS.has_key(unittype):
        return NOW_UNITS[unittype)
    return None

class Any(Unit):
    def __init__(self):
        Unit.__init__(self)
newUnit(Any())

class Meter(Unit):
    def 

class ValueUnit(float):
    def __init__(self, value, unit):
        float.__init__(self, value)
        self.unit = unit
        
    @staticmethod
    def convert(value, unit_before, unit_after):
        if unit_before is unit_after:
            return value
        return value * unit_after.ratio() / unit_before.ratio()

    def __abs__(self):
        return ValueUnit(float.__abs__(self), self.unit)
        
    def __add__(self, other):
        if self.unit.unittype != self.other.unittype:
            raise Exception('Different Type of Data')
        self
        return ValueUnit(float.__add__(self, other), self.unit)
        
    def __div__(self, other):
        if self.unit.unittype != self.other.unittype:
            raise Exception('Different Type of Data')
        return ValueUnit(float.__div__(self, other))
        
    def __divmod__(self, other):
        if self.unit.unittype != self.other.unittype:
            raise Exception('Different Type of Data')

        return ValueUnit(float.__add__(self, other))

